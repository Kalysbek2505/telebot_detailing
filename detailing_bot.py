import telebot
import openai
from telebot import types
import os

TELEGRAM_TOKEN = os.environ.get('TELEGRAM_TOKEN')
OPENAI_API_KEY = os.environ.get('OPENAI_API_KEY')


bot = telebot.TeleBot(TELEGRAM_TOKEN)
openai.api_key = OPENAI_API_KEY


PRICE_LIST = """
üöó –•–∏–º—á–∏—Å—Ç–∫–∞ —Å –ø–æ–ª–Ω—ã–º —Ä–∞–∑–±–æ—Ä–æ–º:
‚Ä¢ –°–µ–¥–∞–Ω—ã: –æ—Ç 8000 –°
‚Ä¢ –ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã: –æ—Ç 9000 –°
‚Ä¢ –î–∂–∏–ø—ã: –æ—Ç 10,000 –°
üéÅ –ü–æ–¥–∞—Ä–æ–∫: 3-—Ö —Ñ–∞–∑–Ω–∞—è –º–æ–π–∫–∞ + —Å—É—Ö–æ–π —Ç—É–º–∞–Ω

‚ú® 3-—Ö —ç—Ç–∞–ø–Ω–∞—è –ø–æ–ª–∏—Ä–æ–≤–∫–∞ + –Ω–∞–Ω–µ—Å–µ–Ω–∏–µ –∫–µ—Ä–∞–º–∏–∫–∏:
‚Ä¢ –°–µ–¥–∞–Ω—ã: –æ—Ç 7000 –°
‚Ä¢ –ö—Ä–æ—Å—Å–æ–≤–µ—Ä—ã: –æ—Ç 9000 –°
‚Ä¢ –î–∂–∏–ø—ã: –æ—Ç 10,000 –°
üéÅ –ü–æ–¥–∞—Ä–æ–∫: 3-—Ö —Ñ–∞–∑–Ω–∞—è –º–æ–π–∫–∞ + –≤–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ —Å–∞–ª–æ–Ω–∞

üì¶ –û–∫–ª–µ–π–∫–∞:
‚Ä¢ –æ—Ç 65,000 –°, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞—à–∏–Ω—ã.
"""

CONTACT_NUMBER = "+996990228885"  

WORK_PROCESS_TEXT = """
üõ† **–ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º?**

1. **–ü–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç** üó£Ô∏è  
   –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–æ–Ω—Ç–∞–∫—Ç–µ —Å –Ω–∞–º–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –æ—Ç –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã. –ú—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –≤—ã—Å–ª—É—à–∞–µ–º –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏ —Ü–µ–ª–∏, –∞ —Ç–∞–∫–∂–µ –æ—Ü–µ–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.

2. **–ü–æ–¥–±–æ—Ä –ø–∞–∫–µ—Ç–∞ —É—Å–ª—É–≥** üéÅ  
   –ú—ã –ø—Ä–µ–¥–ª–æ–∂–∏–º –≤–∞–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø–∞–∫–µ—Ç —É—Å–ª—É–≥, —É—á–∏—Ç—ã–≤–∞—è –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, –±—é–¥–∂–µ—Ç –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø–æ–º–æ–≥—É—Ç –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —É—Å–ª—É–≥ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞–∏–ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ª—É–≥** üöó‚ú®  
   –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –Ω–∞—à–∏ –æ–ø—ã—Ç–Ω—ã–µ –º–∞—Å—Ç–µ—Ä–∞ –ø—Ä–∏—Å—Ç—É–ø–∞—é—Ç –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–¥–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

4. **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞** ‚úÖ  
   –ú—ã —É–¥–µ–ª—è–µ–º –±–æ–ª—å—à–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—é –∫–∞—á–µ—Å—Ç–≤–∞ –∫–∞–∂–¥–æ–π —É—Å–ª—É–≥–∏. –ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ —Å–∞–º–æ–º –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ.

5. **–°–¥–∞—á–∞ –∞–≤—Ç–æ** üöòüéâ  
   –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –º—ã –ø—Ä–æ–≤–µ–¥–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –µ–≥–æ –±–µ–∑—É–ø—Ä–µ—á–Ω–æ–º –≤–Ω–µ—à–Ω–µ–º –≤–∏–¥–µ. –ó–∞—Ç–µ–º –º—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º –≤–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤—Å–µ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã.
"""

def get_response(prompt):
    topic_prompt = f"""
    –¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–≤—Ç–æ-–¥–µ—Ç–µ–π–ª–∏–Ω–≥—É. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–æ–π —Ç–µ–º–æ–π. 
    –ï—Å–ª–∏ —Å–ø—Ä–æ—Å—è—Ç –æ —Ü–µ–Ω–∞—Ö, —É–∫–∞–∂–∏ –∏—Ö —Å —ç–º–æ–¥–∑–∏. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –¥–∞–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–æ–º–ø–∞–Ω–∏–∏: {CONTACT_NUMBER}.
    
    –í–æ—Ç –Ω–∞—à –ø—Ä–∞–π—Å:
    {PRICE_LIST}
    
    –í–æ–ø—Ä–æ—Å: {prompt}
    """
    
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": topic_prompt}]
    )
    return response.choices[0].message['content']

def main_menu():
    markup = types.ReplyKeyboardMarkup(row_width=2, resize_keyboard=True)
    button_prices = types.KeyboardButton("–¶–µ–Ω—ã")
    button_appointment = types.KeyboardButton("–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥—É")
    button_work_process = types.KeyboardButton('–ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º?')
    markup.add(button_prices, button_appointment, button_work_process)
    return markup


@bot.message_handler(commands=['start'])
def send_welcome(message):
    bot.send_message(
        message.chat.id,
        "–î–æ–±—Ä—ã–π –¥–µ–Ω—å —è –ò–ò –∞–≤—Ç–æ –¥–µ—Ç–µ–π–ª–∏–Ω–≥–∞. –ú–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ –∞–≤—Ç–æ-–¥–µ—Ç–µ–π–ª–∏–Ω–≥–∞",
        reply_markup=main_menu()
    )


@bot.message_handler(func=lambda message: message.text in ["–¶–µ–Ω—ã", "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥—É", "–ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º?"])
def handle_menu(message):
    if message.text == "–¶–µ–Ω—ã":
     
        bot.send_message(message.chat.id, f"–ù–∞—à –ø—Ä–∞–π—Å-–ª–∏—Å—Ç:\n{PRICE_LIST}")
    elif message.text == "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥—É":
       
        bot.send_message(message.chat.id, f"–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —É—Å–ª—É–≥—É, –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É: {CONTACT_NUMBER} üìû")
    elif message.text == "–ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º?":
        
        bot.send_message(message.chat.id, WORK_PROCESS_TEXT, parse_mode="Markdown")


@bot.message_handler(func=lambda message: True)
def handle_message(message):
    user_input = message.text.lower()
    
   
    if "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è" in user_input or "–Ω–æ–º–µ—Ä" in user_input or "–ø–æ–∑–≤–æ–Ω–∏—Ç—å" in user_input:
        bot.reply_to(message, f"–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É: {CONTACT_NUMBER} üìû")
    else:
        
        response = get_response(message.text)
        bot.reply_to(message, response)

bot.polling()